From 57c8c194b8ebd5979ad3009b809f6907c2e5e3f5 Mon Sep 17 00:00:00 2001
From: ArchanaShinde1 <archana.shinde2504@gmail.com>
Date: Thu, 3 Aug 2023 09:58:21 +0000
Subject: [PATCH] one

---
 libmamba/src/core/url.cpp | 20 ++++++++++++++------
 1 file changed, 14 insertions(+), 6 deletions(-)

diff --git a/libmamba/src/core/url.cpp b/libmamba/src/core/url.cpp
index 356cf793..6d706d85 100644
--- a/libmamba/src/core/url.cpp
+++ b/libmamba/src/core/url.cpp
@@ -7,6 +7,7 @@
 #include <regex>
 
 #include <openssl/evp.h>
+#include <openssl/provider.h>
 
 #include "mamba/core/context.hpp"
 #include "mamba/core/url.hpp"
@@ -256,16 +257,23 @@ namespace mamba
             u = u.substr(0, u.size() - 13);
         }
 
-        unsigned char hash[16];
 
-        EVP_MD_CTX* mdctx;
-        mdctx = EVP_MD_CTX_create();
-        EVP_DigestInit_ex(mdctx, EVP_md5(), nullptr);
+        const EVP_MD* type = EVP_md5();
+        unsigned char hash[EVP_MAX_MD_SIZE];
+        OSSL_PROVIDER *fips;
+        fips = OSSL_PROVIDER_load(NULL, "fips");
+            if (fips != NULL) 
+            {
+                type = EVP_sha256();
+            }
+        unsigned int mdLen = 0;
+        EVP_MD_CTX *mdctx = EVP_MD_CTX_new();
+        EVP_DigestInit_ex(mdctx, type, nullptr);
         EVP_DigestUpdate(mdctx, u.c_str(), u.size());
-        EVP_DigestFinal_ex(mdctx, hash, nullptr);
+        EVP_DigestFinal_ex(mdctx, hash, &mdLen);
         EVP_MD_CTX_destroy(mdctx);
 
-        std::string hex_digest = hex_string(hash, 16);
+        std::string hex_digest = hex_string(hash, mdLen);
         return hex_digest.substr(0u, 8u);
     }
 
-- 
2.40.1

